<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ========== Monitoring Graphs View ========== -->
    
    <!-- Metric Point Graph View -->
    <record id="view_mikrotik_metric_point_graph" model="ir.ui.view">
        <field name="name">mikrotik.metric.point.graph</field>
        <field name="model">mikrotik.metric.point</field>
        <field name="arch" type="xml">
            <graph string="Metrics Graph" type="line" sample="1">
                <field name="ts_collected"/>
                <field name="value_float" type="measure"/>
            </graph>
        </field>
    </record>

    <!-- Metric Point Pivot View -->
    <record id="view_mikrotik_metric_point_pivot" model="ir.ui.view">
        <field name="name">mikrotik.metric.point.pivot</field>
        <field name="model">mikrotik.metric.point</field>
        <field name="arch" type="xml">
            <pivot string="Metrics Analysis" sample="1">
                <field name="metric_id" type="row"/>
                <field name="ts_collected" type="col"/>
                <field name="value_float" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Traffic Monitoring Action -->
    <record id="action_mikrotik_traffic_graph" model="ir.actions.act_window">
        <field name="name">1Ô∏è‚É£ Interface Traffic</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', 'in', ['iface.rx_bps', 'iface.tx_bps'])]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No traffic data available yet
            </p>
            <p>
                This graph shows real-time RX/TX bandwidth usage per interface.
            </p>
        </field>
    </record>

    <!-- Interface Errors Action -->
    <record id="action_mikrotik_errors_graph" model="ir.actions.act_window">
        <field name="name">2Ô∏è‚É£ Interface Errors &amp; Drops</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', 'in', ['iface.rx_error', 'iface.tx_error', 'iface.rx_drop', 'iface.tx_drop'])]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No error data available yet
            </p>
            <p>
                This graph helps detect bad fiber, cable, SFP, or switch problems.
            </p>
        </field>
    </record>

    <!-- CPU Usage Action -->
    <record id="action_mikrotik_cpu_graph" model="ir.actions.act_window">
        <field name="name">3Ô∏è‚É£ CPU Usage</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', '=', 'system.cpu.load_pct')]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No CPU data available yet
            </p>
            <p>
                Monitor CPU load to detect overload, attacks, or routing stress.
            </p>
        </field>
    </record>

    <!-- RAM Usage Action -->
    <record id="action_mikrotik_ram_graph" model="ir.actions.act_window">
        <field name="name">4Ô∏è‚É£ RAM Usage</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', 'in', ['system.memory.used_pct', 'system.memory.free_bytes'])]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No memory data available yet
            </p>
            <p>
                Track memory usage to detect leaks or overload conditions.
            </p>
        </field>
    </record>

    <!-- Active Connections Action -->
    <record id="action_mikrotik_connections_graph" model="ir.actions.act_window">
        <field name="name">5Ô∏è‚É£ Active Connections</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', '=', 'firewall.connection_count')]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No connection data available yet
            </p>
            <p>
                Monitor active connections to detect heavy loads, abuse, or DDoS attacks.
            </p>
        </field>
    </record>

    <!-- PPPoE Users Action -->
    <record id="action_mikrotik_pppoe_graph" model="ir.actions.act_window">
        <field name="name">9Ô∏è‚É£ PPPoE Online Users</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', '=', 'ppp.active_sessions')]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No PPPoE data available yet
            </p>
            <p>
                Track online PPPoE subscribers in real-time.
            </p>
        </field>
    </record>

    <!-- DHCP Users Action -->
    <record id="action_mikrotik_dhcp_graph" model="ir.actions.act_window">
        <field name="name">üîü DHCP Active Leases</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', 'in', ['dhcp.active_leases', 'dhcp.total_leases'])]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No DHCP data available yet
            </p>
            <p>
                Monitor active DHCP leases over time.
            </p>
        </field>
    </record>

    <!-- System Health Action -->
    <record id="action_mikrotik_health_graph" model="ir.actions.act_window">
        <field name="name">1Ô∏è‚É£2Ô∏è‚É£ System Health</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', 'like', 'system.health.%')]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No health data available yet
            </p>
            <p>
                Monitor temperature, voltage, and fan speed for hardware health.
            </p>
        </field>
    </record>

    <!-- Uptime Action -->
    <record id="action_mikrotik_uptime_graph" model="ir.actions.act_window">
        <field name="name">System Uptime</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', '=', 'system.uptime_seconds')]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No uptime data available yet
            </p>
        </field>
    </record>

    <!-- Disk Usage Action -->
    <record id="action_mikrotik_disk_graph" model="ir.actions.act_window">
        <field name="name">Disk Usage</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[('metric_id.key', '=', 'system.disk.used_pct')]</field>
        <field name="context">{
            'search_default_device_id': active_id,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No disk data available yet
            </p>
        </field>
    </record>

    <!-- All Metrics Dashboard -->
    <record id="action_mikrotik_all_graphs" model="ir.actions.act_window">
        <field name="name">üìä All Monitoring Graphs</field>
        <field name="res_model">mikrotik.metric.point</field>
        <field name="view_mode">graph,pivot,tree</field>
        <field name="domain">[]</field>
        <field name="context">{
            'search_default_device_id': active_id,
            'search_default_last_24h': 1,
        }</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No monitoring data available yet
            </p>
            <p>
                Enable collection on devices to start gathering metrics.
            </p>
        </field>
    </record>

    <!-- Search View with Filters -->
    <record id="view_mikrotik_metric_point_search" model="ir.ui.view">
        <field name="name">mikrotik.metric.point.search</field>
        <field name="model">mikrotik.metric.point</field>
        <field name="arch" type="xml">
            <search string="Metrics">
                <field name="device_id"/>
                <field name="metric_id"/>
                <field name="interface_name"/>
                <separator/>
                <filter name="last_hour" string="Last Hour"
                    domain="[('ts_collected', '&gt;=', (context_today() - relativedelta(hours=1)).strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <filter name="last_24h" string="Last 24 Hours"
                    domain="[('ts_collected', '&gt;=', (context_today() - relativedelta(days=1)).strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <filter name="last_week" string="Last Week"
                    domain="[('ts_collected', '&gt;=', (context_today() - relativedelta(weeks=1)).strftime('%Y-%m-%d %H:%M:%S'))]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter name="group_device" string="Device" context="{'group_by': 'device_id'}"/>
                    <filter name="group_metric" string="Metric" context="{'group_by': 'metric_id'}"/>
                    <filter name="group_interface" string="Interface" context="{'group_by': 'interface_name'}"/>
                    <filter name="group_hour" string="Hour" context="{'group_by': 'ts_collected'}"/>
                    <filter name="group_day" string="Day" context="{'group_by': 'ts_collected'}"/>
                </group>
            </search>
        </field>
    </record>

</odoo>
